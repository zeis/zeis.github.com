<!DOCTYPE HTML>
<html>
  <head>
    <meta http-equiv='content-type' content='text/html; charset=utf-8'>
    <title>C Pointer Conversions</title>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
    <link href='/css/pygments.css' rel='stylesheet'>
    <link href='/css/normalize.css' rel='stylesheet'>
    <link href='/css/font-awesome.min.css' rel='stylesheet'>
    <!--[if lt IE 9]>
    <script src='http://html5shim.googlecode.com/svn/trunk/html5.js'></script>
    <![endif]-->
    <!--[if IE 7]>
    <link rel="stylesheet" href="/css/font-awesome-ie7.min.css">
    <![endif]-->
    <link href='/css/style.css' rel='stylesheet'>
    <link rel='shortcut icon' href='favicon.ico'>

    <!-- Google Analytics (Remove or update this code with your Analytics ID if you forked the GitHub repo) -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23698429-2']);
      _gaq.push(['_trackPageview']);
      (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();
     </script>
    <!-- Google Analytics end-->

  </head>
  <body>
    <div id='top-bar'>
      <nav id='navigation'>
        
        <a class='nav-item' href='/'>
          <i class='icon-home'></i>
          HOME
        </a>
        
        
        <div class='current-nav-item'>
          <a href='/archive.html'>
            <i class='icon-folder-close'></i>
            ARCHIVE
          </a>
        </div>
        
        
        <a class='nav-item' href='/about.html'>
          <i class='icon-star'></i>
          ABOUT
        </a>
        
        <a class='nav-item' href='https://github.com/zeis'>
          <i class='icon-github-alt'></i>
          GITHUB
        </a>
        <a class='nav-item' href='https://twitter.com/aledimax'>
          <i class='icon-twitter'></i>
          TWITTER
        </a>
      </nav>
    </div>
    <div id='container-wrapper'>
      <div id='container'>
        <header>
          <h1 id='blog-title'>
            <a href='/'>Alessandro Di Martino</a>
          </h1>
          <h2 id='blog-subtitle'>Usability, responsiveness, clean code... some words I like</h2>
        </header>
        <hr id='top-separator'/>
        <article>
  <h1>C Pointer Conversions</h1>
  <p class='post-date'>07 Jan 2013</p>
  <p>In C, pointers to a type may be converted to pointers to another type.</p>

<p>According to the current C Standard &#8211; ISO/IEC 9899:2011:</p>

<blockquote>
<p>A pointer to an object or incomplete type may be converted to a pointer to a different object or incomplete type. If the resulting pointer is not correctly aligned for the pointed&#8209;to type, the behavior is undefined.</p>
</blockquote>

<p>It basically means, that a pointer to a type that has more restrictive alignment requirements should never be converted to a pointer to a type that has less restrictive alignment requirements.</p>

<p>For example, in the case of a 64-bit system where <code>int</code> is aligned to 4 bytes, and <code>long</code> is aligned to 8 bytes, the conversion from <code>int*</code> to <code>long*</code> has undefined behavior.</p>
<div class='highlight'><pre><code class='c'><span class='kt'>void</span> <span class='nf'>func</span><span class='p'>(</span><span class='kt'>void</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='kt'>int</span> <span class='n'>i</span><span class='p'>;</span>
    <span class='kt'>long</span><span class='o'>*</span> <span class='n'>lp</span><span class='p'>;</span>

    <span class='n'>printf</span><span class='p'>(</span><span class='s'>&quot;</span><span class='se'>\n</span><span class='s'>%u&quot;</span><span class='p'>,</span> <span class='p'>(</span><span class='kt'>unsigned</span> <span class='kt'>int</span><span class='p'>)</span><span class='k'>sizeof</span><span class='p'>(</span><span class='kt'>int</span><span class='p'>));</span>   <span class='cm'>/* 4 */</span>
    <span class='n'>printf</span><span class='p'>(</span><span class='s'>&quot;</span><span class='se'>\n</span><span class='s'>%u&quot;</span><span class='p'>,</span> <span class='p'>(</span><span class='kt'>unsigned</span> <span class='kt'>int</span><span class='p'>)</span><span class='k'>sizeof</span><span class='p'>(</span><span class='kt'>long</span><span class='p'>));</span>  <span class='cm'>/* 8 */</span>

    <span class='n'>lp</span> <span class='o'>=</span> <span class='p'>(</span><span class='kt'>long</span><span class='o'>*</span><span class='p'>)</span><span class='o'>&amp;</span><span class='n'>i</span><span class='p'>;</span>  <span class='cm'>/* This should be avoided! */</span>
<span class='p'>}</span>
</code></pre></div>
<h2 id='converting__pointers'>Converting <code>void*</code> Pointers</h2>

<p>Pointers to type <code>void</code> are pointers that point to a value that has no type, this allows <code>void*</code> pointers to point to any data type.</p>

<p>A pointer to any type may be converted to a pointer to <code>void</code> and back again to the original type without loss of information.</p>
<div class='highlight'><pre><code class='c'><span class='kt'>void</span> <span class='nf'>func</span><span class='p'>(</span><span class='kt'>void</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='kt'>int</span> <span class='n'>i</span><span class='p'>;</span>
    <span class='kt'>void</span><span class='o'>*</span> <span class='n'>vp</span><span class='p'>;</span>
    <span class='kt'>int</span><span class='o'>*</span> <span class='n'>ip</span><span class='p'>;</span>

    <span class='n'>vp</span> <span class='o'>=</span> <span class='p'>(</span><span class='kt'>void</span><span class='o'>*</span><span class='p'>)</span><span class='o'>&amp;</span><span class='n'>i</span><span class='p'>;</span>
    <span class='n'>ip</span> <span class='o'>=</span> <span class='p'>(</span><span class='kt'>int</span><span class='o'>*</span><span class='p'>)</span><span class='n'>vp</span><span class='p'>;</span> <span class='cm'>/* ip now contains the address of i */</span>
<span class='p'>}</span>
</code></pre></div>
</article>
<div class='spacer'></div>

      </div>
    </div>
    <footer>
      <p>Powered by <a href='https://github.com/mojombo/jekyll'>Jekyll</a>
        <span class='pipe-separator'>|</span>
        Hosting by <a href='http://pages.github.com/'>GitHub Pages</a>
        <span class='pipe-separator'>|</span>
        <a href='https://github.com/zeis/zeis.github.com'>Design</a>
        by <a href='http://alessandrodimartino.com'>Alessandro Di Martino</a>
      </p>
    </footer>
  </body>
</html>
